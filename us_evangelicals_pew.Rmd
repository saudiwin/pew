---
title: "Who Are US Evangelical Christians?"
output: html_notebook
---

```{r setup, include=FALSE}

library(haven)
require(dplyr)
require(ggplot2)
require(magrittr)
require(mirt)
require(tidyr)
require(plotly)
require(stringr)

set.seed(111379)

Dataset_Pew <- read_sav("Dataset - Pew Research Center 2014 Religious Landscape Study National Telephone Survey - Version 1.1 - December 1 2016.sav")

#Need to relabel/relevel some variables to calculate correct reference categories

Dataset_Pew$RELTRAD <- as_factor(Dataset_Pew$RELTRAD)
Dataset_Pew$RELTRAD <- relevel(Dataset_Pew$RELTRAD,"Don't know/refused - no information on religious identity")
levels(Dataset_Pew$RELTRAD) <- c("Don't Know","Evangelical<br>Protestant","Mainline<br>Protestant",                           "Black<br>Protestant", "Catholic", "Mormon", "Orthodox<br>Christian", "Jehovah's<br>Witness","Other<br>Christian","Jewish","Muslim","Buddhist","Hindu","Other<br>Religions","Other<br>Faiths","None")

Dataset_Pew$RELTRAD <- recode_factor(Dataset_Pew$RELTRAD,'Other<br>Religions'="Other<br>Faiths")

levels(Dataset_Pew$RELTRAD) <- c("Don't Know","Buddhist","Evangelical<br>Protestant","Mainline<br>Protestant",                           "Black<br>Protestant", "Catholic", "Mormon", "Orthodox<br>Christian", "Jehovah's Witness","Other<br>Christian","Jewish","Muslim","Hindu","Other<br>Faiths","None")

Dataset_Pew$income <- str_extract(as.character(as_factor(Dataset_Pew$income)),pattern = '\\$[1-9]+.+')
Dataset_Pew$income <- as.factor(Dataset_Pew$income)

data <- Dataset_Pew

#Need to use survey weights. Won't change actual analysis very much, but still a good thing to do

weights <- Dataset_Pew$WEIGHT





# Keep variables

data %<>% select(qi2g,qi2d,qi2b,qi2a,qi1,qh2,qh1,qg7b,qg7,qg6,qg5,qg1c,qg3,qg1,qg1b,qf2,
                 attend,born,racethn,marital,qb31,qb30,qb22,qb21,qb20,
                 qb21,qb22,qb20,qb2a,qb2c,qb2b,qb2d,qb1c,qb1b,qb1a,qa1,qi3,qp3rec,educ,agerec,
                 qm5a,qm5b,qm5d,qm5e,qm5f,qm5g,party,ideo,income,RELTRAD)

data %<>% mutate_all(as_factor) %>% mutate_all(as.character)

data %<>% mutate_all(funs(ifelse(grepl(x=.,pattern="VOL|NaN|[Dd]on't [Kk]now|[Rr]efused|Undesignated|Did Not Report"),NA,.)))

ordinal_vars <- c('qi2g','qi2d','qi2b','qi2a','qi1','qg1b','qf2','attend','qb22','qb21','qb1c',
                  'qb1b','qb1a','qa1','educ','agerec','ideo','income')
binary_vars <- c('qh2','qh1','qg7','qg7b','qg6','qg5','qg1c','qg3','qg1','born','qb30','qb20',
                 'qb2a','qb2c','qb2b','qb2d','qi3','qp3rec','qm5a','qm5b','qm5d','qm5e','qm5f','qm5g')
nominal_vars <- names(data)[!(names(data) %in% c(ordinal_vars,binary_vars))]

all_vars <- c(ordinal_vars,binary_vars,nominal_vars)

# Order by these categories to make it easier to code them for the IRT model

data %<>% select(one_of(c(ordinal_vars,binary_vars,nominal_vars)))

item_types <- c(rep('graded',length(ordinal_vars)),
                rep('2PL',length(binary_vars)),
                rep('nominal',length(nominal_vars)))

data %<>% mutate_all(as.factor)

data %<>% mutate(RELTRAD = relevel(RELTRAD,'Other<br>Faiths'))
levels(data$income) <- c('$10,000','$20,000','$30,000','$40,000','$50,000','$75,000','$100,000',
                                '$150,000','$150,000 or more')
numeric <- data.matrix(data)
colnames(numeric) <- names(data)

#Unidimensional 2PL Rasch combined ordinal/binary/nominal factor analysis
#If you get an error, just rerun this code. Sometimes the EM algorithm can get stuck in a flat log-likelihood
model <- mirt(numeric,model=2,itemtype=item_types,survey.weights=weights)
person_scores <- fscores(model) %>% as_data_frame
```

### How We Know Who We Are

This recent election season exposed deep divides within Christians from different denominations. We still don't have good data on exactly how Christians voted--exit polls are not reliable or useful for this question--but it is clear that there are substantial differences among Christians of different ages, churches and ethnicities. In particular, a lot of attention in the media centered on U.S. evangelical Christians, a very broad term that nonetheless is a good predictor of how people vote in elections.

I wanted to look more concretely at the question of what an evangelical Christian is. Instead of defining the term by what an evangelical Christian should be, I examined the question from the perspective of what American ssay about themselves. The best data source for this question are the Pew surveys on religion and politics, the most recent of which was [just released](http://www.pewforum.org/religious-landscape-study/). Although the survey dates from 2014, it is the best available evidence because it used a very large sample--over 30,000 respondents--and contained a battery of questions concerning both religious and political views. For that reason, it is ideal for understanding what it means to be evangelical.

There are different ways of slicing and dicing this survey. We could, for example, take the question from the survey that asks people if they are evangelical Christians, and then restrict our focus to only this group. However, the evangelical label has been stretched and challenged by so many people that it seems can describe people with remarkably contrasting beliefs. 

Instead, I used a statistical model^[I used the R package mirt to estimate a 2PL item-response theory model. The full code is available in the code folder of our website's Github at (http://www.github.com/saudiwin/saudiwin.github.io). The model includes sampling weights to account for the sampling design.] to collapse the survey's questions down to two dimensions. I didn't know ahead of time what dimensions these would be, although I suspected that it would collapse to a left-right political scale and a conservative-liberal theology scale. The data analysis largely confirms my prior suspicions. The table below shows the three questions that best explained each of the two dimensions:

    Dimension 1                                       Dimension 2
----------------------------------------        ------------------------------------------- 
Do you believe in God?                            Do you prefer small or big government?
Is the Bible the Word of God?                     Are you a citizen of the United States?
How important is religion in your life?           Do you read the Bible literally?
Do you believe in heaven?                         Do churches focus too much on rules?        

We label the first dimension as religious belief and the second dimension as political opinions. The first appears to measure the difference between secular-liberal and conservative religious beliefs, particularly between Christians and others. The top question for the second dimension on a standard difference between the political left and the political right: the size of government. The second question, about whether the respondent is a US citizen, clearly identifies political differences. The final two questions are interesting because we think of them as religious questions, but they could be interpreted as implying religious attitudes that tend to be political. For example, depending on what reading the Bible "literally" means, a respondent's political views may be more or less guided by passages from the Bible that talk about politics. Perhaps churches and rules refers to respondents who are very libertarian. However, this is just speculation, and it's important not to over-interpret the results of the model.

The plot below shows respondents plotted along these dimensions. We can see from the general shape of the points that there are more people who tend to have conservative beliefs with conservative politics and vice versa. However there are a fair number of people who mix and match these kinds of beliefs and politics.

```{r factor_plot, echo=FALSE}
#Use only 1500 points for better plotting
a <- list(
  x = c(1.75,-2,-2.5,1),
  y = c(-2.1,-2.3,2,2.3),
  text = c('Liberal Belief<br>Conservative Politics',
           'Conservative Belief<br>Conservative Politics',
           'Conservative Belief<br>Liberal Politics',
           'Liberal Belief<br>Liberal Politics'),
  xref = 'x',
  yref = "y",
  showarrow = FALSE,
  ax = 0,
  ay = 0
)

person_scores %<>% mutate(data_labels=paste0('State: ',as_factor(Dataset_Pew$state),'<br>','Age: ',as_factor(Dataset_Pew$agerec),'<br>Income: ',Dataset_Pew$income),
                          region=as_factor(Dataset_Pew$cregion))

 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels,hoverinfo='text') %>% add_markers() %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
         yaxis=list(title='Political Opinion',showticklabels = FALSE)) 
#   
#   ggplot(aes(y=F2,x=F1)) + geom_hline(yintercept=0,colour='grey') +
#   geom_vline(xintercept=0,colour='grey') + geom_point(colour='dark blue') + theme_minimal() + xlab('Religious Belief') + ylab('Political Opinion')  + annotate('text',x=1.75,y=-2.1,label='Liberal Belief\nConservative Politics') + 
#   annotate('text',x=-2,y=-2.2,label='Conservative Belief\nConservative Politics') +
# annotate('text',x=-2.5,y=2,label='Conservative Belief\nLiberal Politics') +
#   annotate('text',x=1,y=2.1,label='Liberal Belief\nLiberal Politics') %>% ggplotly
```

These questions are best able to differentiate the respondents into different camps. The shape for the points has a slightly squashed look because there are more points in Conservative Belief/Conservative Politics and Liberal Belief/Liberal Politics than in the other categories. This implies that there is some connection between belief and politics, although it is not perfect. 

We can use the other questions in the survey to analyze how people differ along their demographic background and political opinions, including religious denominations, age, income, government policies, and theological perspectives.

First of all, we can look at the list of religious groups to see how they all stack up against each other. We use a question from the survey that tracked a considerable number of religious categories so that we can look at evangelical Christians compared others. We plot each of these categories on our chart to see how they stand relative to all the respondents. The plot below shows the scores on the first dimensions, religious belief, for several different denominations and religious categories. 

```{r reltrade, echo=FALSE, message=FALSE, warning=FALSE}
# Need to use the same rotation as the person scores
all_coefs <- coef(model,rotate='oblimin')

all_coefs$GroupPars <- NULL

ordinal_coefs <- all_coefs[item_types=='graded' | item_types=='2PL']
nominal_coefs <- all_coefs[item_types=='nominal']
# ordinal_coefs <- lapply(ordinal_coefs,function(x) {
#   x <- x[grepl(pattern='a[0-9]',x=attr(x,'dimnames')[[2]])]
#   return(x)})

reltrad_slope <-  nominal_coefs$RELTRAD[grepl(pattern='a[0-9]',x=attr(nominal_coefs$RELTRAD,'dimnames')[[2]])]
reltrad_coefs <- nominal_coefs$RELTRAD[grepl(pattern='ak[0-9]+',x=attr(nominal_coefs$RELTRAD,'dimnames')[[2]])]
reltrad_labels <- levels(data$RELTRAD)[2:length(levels(data$RELTRAD))]
reltrad_data <- data_frame(dim1=reltrad_slope[[1]]*reltrad_coefs[reltrad_coefs!=0],
                           dim2=reltrad_slope[[2]]*reltrad_coefs[reltrad_coefs!=0],
                        labels=reltrad_labels)
reltrad_data %>% plot_ly(type='bar',x=~dim1,y=~reorder(labels,dim1),orientation='h',text=~labels) %>% layout(xaxis=list(title='Religous Belief (Conservative to Liberal)'),
                                                                                                             yaxis=list(title=''))
reltrad_data %>% plot_ly(type='bar',x=~dim1,y=~reorder(labels,dim1),orientation='h',text=~labels) %>% layout(xaxis=list(title='Religous Belief (Conservative to Liberal)'), yaxis=list(title=''),margin=list(l=100))
```

This plot should be interpreted with caution because it is using a limited number of questions to differentiate respondents along basic beliefs, such as belief in God and whether God's word is inspired. However, it is still interesting that Evangelical Protestants are closer to Muslims than they are to Mainline Protestants or even Jewish people. This graph does seem to capture some intuitive idea about how close and far different religious groups are, at least when it comes to belief in God and the relative proximity between religious groups. As the Catholic philosopher Peter Kreeft once joked,

> I often find more mutual understanding between myself and a fundamentalist Southern Baptist who sincerely believes I am worshipping the great whore of Babylon and on my way to Hell, or with a Muslim who uncompromisingly rejects my belief that Christ is Lord as utter pagan blasphemy, than I find with some active Catholic laity, nuns, especially ex-nuns, priests and even bishops! 

These differences reflect more cultural understanding of faith than they do deep issues of doctrine.

Next we look at demographic factors. First, do people of varying incomes tend to cluster in certain categories? The chart below shows that income does not vary much along religious beliefs (the horizontal dimension), but rather mostly along the vertical dimension, political opinion. Again, this finding is not surprising given how we know that wealthier people in the United States tend to be more conservative.

```{r regions,echo=FALSE}
income_slope <-  ordinal_coefs$income[grepl(pattern='a[0-9]',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_coefs <- ordinal_coefs$income[grepl(pattern='d[0-9]+',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_labels <- levels(data$income)[2:length(levels(data$income))]
dims <- sapply(income_coefs, function(x) (-x*income_slope)/(sqrt(sum(income_slope^2))))
income_data <- data_frame(dim1=dims[1,],
                           dim2=dims[2,],
                        labels=income_labels)


 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels) %>% add_markers(hoverinfo='text',name='All Respondents',opacity=0.1) %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
         yaxis=list(title='Political Opinion',showticklabels = FALSE)) %>% add_markers(data=income_data,y=~dim2,x=~dim1,inherit=FALSE,name='Income Categories') %>% add_text(data=income_data,x=~dim1,y=~dim2,text=~labels,name='Point Labels',textposition='bottom left')
```

Next we'll put education on the same plot so that we can look at income and education together.

```{r}
income_slope <-  ordinal_coefs$income[grepl(pattern='a[0-9]',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_coefs <- ordinal_coefs$income[grepl(pattern='d[0-9]+',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_labels <- levels(data$income)[2:length(levels(data$income))]
dims <- sapply(income_coefs, function(x) (-x*income_slope)/(sqrt(sum(income_slope^2))))
income_data <- data_frame(dim1=dims[1,],
                           dim2=dims[2,],
                        labels=income_labels)


 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels) %>% add_markers(hoverinfo='text',name='All Respondents',opacity=0.1) %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
         yaxis=list(title='Political Opinion',showticklabels = FALSE)) %>% add_markers(data=income_data,y=~dim2,x=~dim1,inherit=FALSE,name='Income Categories') %>% add_text(data=income_data,x=~dim1,y=~dim2,text=~labels,name='Point Labels',textposition='bottom left')
```

