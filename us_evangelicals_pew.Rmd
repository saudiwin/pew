---
title: "Who Are US Evangelical Christians?"
output: html_notebook
---

```{r setup, include=FALSE}

library(haven)
require(dplyr)
require(ggplot2)
require(magrittr)
require(mirt)
require(tidyr)
require(plotly)
require(stringr)

opts_chunk$set(fig.align='center')

set.seed(111379)

Dataset_Pew <- read_sav("Dataset - Pew Research Center 2014 Religious Landscape Study National Telephone Survey - Version 1.1 - December 1 2016.sav")

#Need to relabel/relevel some variables to calculate correct reference categories

Dataset_Pew$RELTRAD <- as_factor(Dataset_Pew$RELTRAD)
Dataset_Pew$RELTRAD <- relevel(Dataset_Pew$RELTRAD,"Don't know/refused - no information on religious identity")
levels(Dataset_Pew$RELTRAD) <- c("Don't Know","Evangelical<br>Protestant","Mainline<br>Protestant",                           "Black<br>Protestant", "Catholic", "Mormon", "Orthodox<br>Christian", "Jehovah's<br>Witness","Other<br>Christian","Jewish","Muslim","Buddhist","Hindu","Other<br>Religions","Other<br>Faiths","None")

Dataset_Pew$RELTRAD <- recode_factor(Dataset_Pew$RELTRAD,'Other<br>Religions'="Other<br>Faiths")

levels(Dataset_Pew$RELTRAD) <- c("Don't Know","Buddhist","Evangelical<br>Protestant","Mainline<br>Protestant",                           "Black<br>Protestant", "Catholic", "Mormon", "Orthodox<br>Christian", "Jehovah's<br>Witness","Other<br>Christian","Jewish","Muslim","Hindu","Other<br>Faiths","None")

Dataset_Pew$income <- str_extract(as.character(as_factor(Dataset_Pew$income)),pattern = '\\$[1-9]+.+')
Dataset_Pew$income <- as_factor(Dataset_Pew$income)
levels(Dataset_Pew$qi2g) <- c('Never','Seldom', 'Several times a year','Once or twice a month','At least once a week')

data <- Dataset_Pew

#Need to use survey weights. Won't change actual analysis very much, but still a good thing to do

weights <- Dataset_Pew$WEIGHT

# Keep variables

data %<>% select(qi2g,qi2d,qi2b,qi2a,qi1,qh2,qh1,qg7b,qg7,qg6,qg5,qg1c,qg3,qg1,qg1b,qf2,
                 attend,born,racethn,marital,qb31,qb30,qb22,qb21,qb20,
                 qb21,qb22,qb20,qb2a,qb2c,qb2b,qb2d,qb1c,qb1b,qb1a,qa1,qi3,qp3rec,educ,agerec,
                 qm5a,qm5b,qm5d,qm5e,qm5f,qm5g,party,ideo,income,RELTRAD)

ordinal_vars <- c('qi2g','qi2d','qi2b','qi2a','qi1','qg1b','qf2','attend','qb22','qb21','qb1c',
                  'qb1b','qb1a','qa1','educ','agerec','ideo','income')
binary_vars <- c('qh2','qh1','qg7','qg7b','qg6','qg5','qg1c','qg3','qg1','born','qb30','qb20',
                 'qb2a','qb2c','qb2b','qb2d','qi3','qp3rec','qm5a','qm5b','qm5d','qm5e','qm5f','qm5g')
nominal_vars <- names(data)[!(names(data) %in% c(ordinal_vars,binary_vars))]

all_vars <- c(ordinal_vars,binary_vars,nominal_vars)

# Order by these categories to make it easier to code them for the IRT model

data %<>% select(one_of(c(ordinal_vars,binary_vars,nominal_vars)))

data %<>% as_factor('labels')

keep_labels <- lapply(data,levels)

data %<>% mutate_all(funs(ifelse(grepl(x=.,pattern="VOL|NaN|[Dd]on't [Kk]now|[Rr]efused|Undesignated|Did Not Report"),NA,.)))

keep_labels <- lapply(keep_labels,function(x) {
  x[!grepl(x=x,pattern="VOL|NaN|[Dd]on't [Kk]now|[Rr]efused|Undesignated|Did Not Report")]
})
keep_names <- names(data)
data <-  lapply(1:length(names(data)),function(x) {
  this_col <- data[[x]]
  this_col <- factor(this_col,labels=keep_labels[[x]])
  return(this_col)
})
names(data) <- keep_names
data %<>% as_data_frame

item_types <- c(rep('graded',length(ordinal_vars)),
                rep('2PL',length(binary_vars)),
                rep('nominal',length(nominal_vars)))

data %<>% mutate(RELTRAD = relevel(RELTRAD,'Other<br>Faiths'))
levels(data$income) <- c('$10,000','$20,000','$30,000','$40,000','$50,000','$75,000','$100,000',
                                '$150,000','$150,000 or more')

data$educ <- factor(data$educ,levels= c("Less than high school (Grades 1-8 or no formal schooling)",
                       "High school incomplete (Grades 9-11 or Grade 12 with NO diploma)",
                       "High school graduate (Grade 12 with diploma or GED certificate)",
                       "Some college, no degree (includes some community college)",
                       "Two year associate degree from a college or university",
                       "Four year college or university degree/Bachelor's degree (e.g., BS, BA, AB)",
                       "Some postgraduate or professional schooling, no postgraduate degree (e.g. some graduate school)",
                       "Postgraduate or professional degree, including master's, doctorate, medical or law degree (e.g., MA, MS, PhD, MD...)"),
                    labels=c('Middle School','Some HS','HS Grad','Some College','2-yr Degree','4-yr Degree','Some Grad School','Grad Degree'))

#One of the questions has very odd question order, need to change to make fully ordinal

data$qb1a <- factor(data$qb1a,levels=c("Change for the better","Hasn't made much difference",
                                       "Change for the worse"))
data$qb1b <- factor(data$qb1b,levels=c("Change for the better","Hasn't made much difference",
                                       "Change for the worse"))
data$qb1c <- factor(data$qb1c,levels=c("Change for the better","Hasn't made much difference",
                                       "Change for the worse"))

numeric <- data.matrix(data)
colnames(numeric) <- names(data)

#Unidimensional 2PL Rasch combined ordinal/binary/nominal factor analysis
#If you get an error, just rerun this code. Sometimes the EM algorithm can get stuck in a flat log-likelihood
model <- mirt(numeric,model=2,itemtype=item_types,survey.weights=weights)
person_scores <- fscores(model) %>% as_data_frame
```

### How We Know Who We Are

This recent election season exposed deep divides within Christians from different denominations. We still don't have good data on exactly how Christians voted--exit polls are not reliable or useful for this question--but it is clear that there are substantial differences among Christians of different ages, churches and ethnicities. In particular, a lot of attention in the media centered on U.S. evangelical Christians, a very broad term that nonetheless is a good predictor of how people vote in elections.

I wanted to look more concretely at the question of what an evangelical Christian is. Instead of defining the term by what an evangelical Christian should be, I examined the question from the perspective of what American say about themselves. The best data source for this question are the Pew surveys on religion and politics, the most recent of which was [just released](http://www.pewforum.org/religious-landscape-study/). Although the survey dates from 2014, it is the best available evidence because it used a very large sample--over 30,000 respondents--and contained a battery of questions concerning both religious and political views. For that reason, it is ideal for understanding what it means to be evangelical.

There are different ways of slicing and dicing this survey. We could, for example, take the question from the survey that asks people if they are evangelical Christians, and then restrict our focus to only this group. However, the evangelical label has been stretched and challenged by so many people that it seems it can describe people with remarkably contrasting beliefs. 

Instead, I used a statistical model^[I used the R package mirt to estimate a 2PL item-response theory model. The full code is available in the code folder of our website's Github at (http://www.github.com/saudiwin/saudiwin.github.io). The model includes sampling weights to account for the sampling design.] to collapse the survey's questions down to two dimensions. I didn't know ahead of time what dimensions these would be, although I suspected that it would collapse to a left-right political scale and a conservative-liberal theology scale. The data analysis largely confirms my prior suspicions. The table below shows the three questions that best explained each of the two dimensions:

    Dimension 1                                       Dimension 2
-----------------------------------------------   --------------------------------------------
Do you believe in God or a universal spirit?          Do you prefer small or big government?
How important is religion in your life?               Does government aid to the poor do more harm than good?
Is the Bible the Word of God?                         Are you conservative/moderate/liberal?
Should homosexuality be accepted by society?          Should homosexuality be accepted by society?

I decided to label the first dimension as religious belief and the second dimension as political opinions. The first appears to measure the difference between secular-liberal and conservative religious beliefs, such as whether a person believes in God and believes that the Bible is the Word of God. The top question for the second dimension reflects a fundamental divide between the political left and the political right: the size of government. Similarly, the second-most divisive political question concerns a perennial debate over the welfare state and whether the government should be involved. What is interesting to note is that the question about homosexuality discriminates on *both* dimensions. Knowing someone's views about homosexuality communicates information about both their religious and political beliefs, so we will certainly examine this question to understand how it fits in the picture.

The plot below shows respondents plotted along these dimensions. We can see from the general shape of the points that there is an oblong, Milky Way galaxy-type shape. This is because people tend to cluster in the top left, liberal religion and liberal politics, and on the bottom right, which is conservative religion and conservative politics. However, there are people who mix and match these beliefs, as they fall into the other two cells. People who are at the exact center are very difficult to classify using either dimension. These are the special cupcakes in the population: they don't conform to our simplistic analysis of religion and politics. But for a large number of Americans, these two dimensions do tell us a lot.

```{r factor_plot, echo=FALSE}
#Use only 1500 points for better plotting
a <- list(
  x = c(3.3,-3.6,0,-.25),
  y = c(0,0,2.6,-2.8),
  text = c('Conservative<br>Religion',
           'Liberal<br>Religion',
           'Liberal Politics',
           'Conservative Politics'),
  xref = 'x',
  yref = "y",
  showarrow = FALSE,
  ax = 0,
  ay = 0
)

person_scores %<>% mutate(data_labels=paste0('State: ',as_factor(Dataset_Pew$state),'<br>','Age: ',data$agerec,'<br>Income: ',data$income,'<br>Education: ',data$educ),
                          region=as_factor(Dataset_Pew$cregion))

 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels,hoverinfo='text') %>% add_markers() %>% 
  layout(annotations=a,xaxis=list(showticklabels = FALSE),
         yaxis=list(showticklabels = FALSE)) 
```

We can use the other questions in the survey to analyze how people differ along their demographic background and political opinions, including religious denominations, age, income, government policies, and theological perspectives.

First of all, we can look at the list of religious groups to see how they all stack up against each other. We use a question from the survey that tracked a considerable number of religious categories so that we can look at evangelical Christians compared others. We plot each of these categories on our chart to see how they stand relative to all the respondents. The chart below shows the scores on the first dimensions, religious belief, for several different denominations and religious categories. 

```{r reltrade, echo=FALSE, message=FALSE, warning=FALSE}
# Need to use the same rotation as the person scores
all_coefs <- coef(model,rotate='oblimin')

all_coefs$GroupPars <- NULL

ordinal_coefs <- all_coefs[item_types=='graded' | item_types=='2PL']
nominal_coefs <- all_coefs[item_types=='nominal']
# ordinal_coefs <- lapply(ordinal_coefs,function(x) {
#   x <- x[grepl(pattern='a[0-9]',x=attr(x,'dimnames')[[2]])]
#   return(x)})

reltrad_slope <-  nominal_coefs$RELTRAD[grepl(pattern='a[0-9]',x=attr(nominal_coefs$RELTRAD,'dimnames')[[2]])]
reltrad_coefs <- nominal_coefs$RELTRAD[grepl(pattern='ak[0-9]+',x=attr(nominal_coefs$RELTRAD,'dimnames')[[2]])]
reltrad_labels <- levels(data$RELTRAD)[2:length(levels(data$RELTRAD))]
reltrad_data <- data_frame(dim1=reltrad_slope[[1]]*reltrad_coefs[reltrad_coefs!=0],
                           dim2=reltrad_slope[[2]]*reltrad_coefs[reltrad_coefs!=0],
                        labels=reltrad_labels)
reltrad_data %>% plot_ly(type='bar',x=~dim1,y=~reorder(labels,dim1),orientation='h',text=~labels) %>% layout(xaxis=list(title='Religous Belief (Conservative to Liberal)'), yaxis=list(title=''),margin=list(l=100))
```

This plot should be interpreted with caution because it is using a limited number of questions to differentiate respondents along basic beliefs, such as belief in God and whether God's word is inspired. However, it is still interesting that Evangelical Protestants are closer to Muslims than they are to Mainline Protestants or even Jewish people. This graph does seem to capture some intuitive idea about how close and far different religious groups are, at least when it comes to belief in God and the relative proximity between religious groups. As the Catholic philosopher Peter Kreeft once joked,

> I often find more mutual understanding between myself and a fundamentalist Southern Baptist who sincerely believes I am worshipping the great whore of Babylon and on my way to Hell, or with a Muslim who uncompromisingly rejects my belief that Christ is Lord as utter pagan blasphemy, than I find with some active Catholic laity, nuns, especially ex-nuns, priests and even bishops! 

These differences reflect a more cultural understanding of faith than they do deep issues of doctrine.

Next we look at demographic factors. First, do people of varying incomes tend to cluster in certain categories? The chart below shows that income does not vary much along religious beliefs (the horizontal dimension), but rather mostly along the vertical dimension, political opinion. Again, this finding is not surprising given how we know that wealthier people in the United States tend to be more conservative. It should be noted too, that these lines are just estimates--it is most likely that people in these income categories will fall in between these lines, but you can find plenty of respondents on the plot that don't fall into these neat buckets. What it does tell us is that, regardless of anything else, including religious belief, wealthier people are more conservative. On the other hand, we don't know whether a wealthy person is necessarily more or less conservative when it comes to religion: there are both conservative and liberal wealthy respondents.

```{r regions,echo=FALSE,fig.align='center'}
income_slope <-  ordinal_coefs$income[grepl(pattern='a[0-9]',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_coefs <- ordinal_coefs$income[grepl(pattern='d[0-9]+',x=attr(ordinal_coefs$income,'dimnames')[[2]])]
income_labels <- levels(data$income)[2:length(levels(data$income))]
dims <- sapply(income_coefs, function(x) (-x*income_slope)/(sqrt(sum(income_slope^2))))
calc_points <- apply(dims,2,function(x) {
  m <- (-x[1]/x[2])
  b <- (-m*x[1]) + x[2]
  points <- m*(seq(from=-2,to=2,length.out=100)) + b
})
income_data <- as_data_frame(calc_points)
names(income_data) <- income_labels
income_data$xpoints <- seq(from=-2,to=2,length.out=100)
income_data <-  gather(income_data,categories,ypoints,-xpoints)
text_data <- data_frame(dim1=dims[1,],dim2=dims[2,],labels=income_labels)

 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels) %>% add_markers(hoverinfo='text',name='All Respondents',opacity=0.1) %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
         yaxis=list(title='Political Opinion',showticklabels = FALSE)) %>% add_lines(data=income_data,y=~ypoints,x=~xpoints,color=~categories,inherit=FALSE,name='Income Categories') %>% add_text(data=text_data,x=~dim1,y=~dim2,text=~labels,name='Point Labels',textposition='bottom right')
```

Next we'll look at education. This chart shows that the effect education is very different from income--while income tells us how politically conservative or liberal someone is, education is much more likely to tell us how conservative or liberal their religion is. There are people who are politically conservative who are well-educated, but at the same time these same people also tend to be more liberal in terms of their beliefs.

```{r}
educ_slope <-  ordinal_coefs$educ[grepl(pattern='a[0-9]',x=attr(ordinal_coefs$educ,'dimnames')[[2]])]
educ_coefs <- ordinal_coefs$educ[grepl(pattern='d[0-9]+',x=attr(ordinal_coefs$educ,'dimnames')[[2]])]
educ_labels <- levels(data$educ)[2:length(levels(data$educ))]
dims <- sapply(educ_coefs, function(x) (-x*educ_slope)/(sqrt(sum(educ_slope^2))))

calc_points <- apply(dims,2,function(x) {
  m <- (-x[1]/x[2])
  b <- (-m*x[1]) + x[2]
  points <- (seq(from=-2,to=2,length.out=100) - b)/m
})
educ_data <- as_data_frame(calc_points)
names(educ_data) <- educ_labels
educ_data$ypoints <- seq(from=-2,to=2,length.out=100)
educ_data <-  gather(educ_data,categories,xpoints,-ypoints)
to_choose <- floor(nrow(calc_points)/length(educ_labels))
plot_text <- sapply(1:length(educ_labels),function(x) {
  y <- calc_points[,x][(x*14)-13]
  x <- seq(from=-2,to=2,length.out=100)[(x*14)-13]
  return(c(x,y))
})

text_data <- data_frame(dim1=plot_text[2,],
                           dim2=plot_text[1,],
                        labels=educ_labels)


 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels) %>% add_markers(hoverinfo='text',name='All Respondents',opacity=0.1) %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
 yaxis=list(title='Political Opinion',showticklabels = FALSE)) %>% add_lines(data=educ_data,y=~ypoints,x=~xpoints,color=~categories,inherit=FALSE,name='Education',
                                                                             text=~categories) 
 # %>% add_text(data=text_data,x=~dim1,y=~dim2,text=~labels,name='Point Labels',textposition='bottom left')
```

Given these two differing effects of income and education, we can learn something by putting the lines onto the same plot, making cross-hatch. (Yes, we are literally putting people in boxes). Now we have a bunch of pick-up sticks laid on top of our chart. While it is a bit too much to absorb, it shows how income and education have a complicated interaction when it comes to people's religious and political beliefs. To give just one interesting interpretation, there is a big box of people who have a very high income (more than $150K) but low education (high school or less). These people tend to have very conservative politics but their religious beliefs are more conservative. On the flip side, the box with people with high income and high education shows that they are more liberal politically, although they also have more conservative beliefs. In other words, people are complicated, and we can't always know people's beliefs just by knowing only their education or income.

```{r,echo=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
 person_scores %>% sample_n(1500) %>% plot_ly(y=~F2,x=~F1,text=~data_labels) %>% add_markers(hoverinfo='text',name='All Respondents',opacity=0.1) %>% 
  layout(annotations=a,xaxis=list(title='Religious Belief',showticklabels = FALSE),
         yaxis=list(title='Political Opinion',showticklabels = FALSE)) %>% add_lines(data=income_data,y=~ypoints,x=~xpoints,linetype=~categories,inherit=FALSE,name='Income Categories',text=~categories) %>% add_lines(data=educ_data,y=~ypoints,x=~xpoints,color=~categories,inherit=FALSE,name='Education',
                                                                             text=~categories) 
```

Now we're going to dig deep into how people identify in terms of religion and what that says about their politics. First, we'll look at responses to the question, ``How often do you share your faith with non-believers or people from other religious backgrounds?"

